# MyRPi5
MyRPi5 — это веб-приложение для мониторинга температуры и управления дополнительным кулером вашей Raspberry Pi 5, через Docker. Решение ориентировано на автоматизацию контроля температуры устройства в реальном времени и интеллектуальное управление кулером для предотвращения перегрева и повышения стабильности работы. 

![full](https://github.com/user-attachments/assets/a82b88ae-dd99-4ea0-bcae-2f8f5709bcfb)

* Подключен bootstrap
* Поддержка PWA 
* Анимация кулеров в соответствии с фактическими оборотами, 1:100.
* Уровни температур: низкая, средняя, высокая.
* Отображение состояния питания вашей RPi. Если есть или было недостаточное напряжение - вы узнаете об этом.
* Топ 7 процессов по загрузке CPU, с отображением общего количества процессов.
* Топ 7 контейнеров Docker по загрузке CPU, с отображением общего количества контейнеров.



## Подключение дополнительного кулера:
Я использую кулер **noctua a4x10 pwm**, схема подключения: `yellow / 5v; grey / ground; blue / gpio14; green / gpio18`. Если удобно, пин управления оборотами и их подсчетами можно изменить на свои, далее в конфиге fan.py. 
> [!NOTE]
> При желании пин управления оборотами и их подсчетами можно изменить, далее в конфиге fan.py.

> [!CAUTION]
> Будьте аккуратнее в работе с подключением других куллеров - можно сжечь свой rpi.

![1cd10550eea533bb25967325f87732b4 (2)](https://github.com/user-attachments/assets/ab69ca6b-33e5-43a5-ac89-3cbd0ed19033)

## Про скрипт управления дополнительного вентилятора:
Скрипт реализует двухпороговую систему управления с гистерезисом, что предотвращает частые включения/выключения кулера при колебаниях температуры около пороговых значений. Это обеспечивает стабильную работу системы охлаждения без постоянных переключений. 
Настройки управления дополнительного кулера вы найдете в fan.py. Они в принципе оптимальны, но опять же индивидуальны для ваших корпусов и среды обитания вашей rpi. Вы можете изменить их в данном блоке:
```
PWM_PIN = 14                    # GPIO 14 для управления оборотами кулера
TACH_PIN = 23                   # GPIO 23 для подсчета оборотов
TEMP_MIN = 45                   # Минимальная температура включения кулера (°C)
TEMP_MAX = 75                   # Максимальная температура для работы на полную мощность (°C)
HOLD_100_PERCENT = 10           # Время удержания максимальных оборотов после достижения пиковой температуры (сек)
SHUTDOWN_DELAY = 30             # Задержка перед выключением кулера после снижения до минимальной температуры (сек)
IMPULSES_PER_REVOLUTION = 2     # Количество импульсов тахометра за один оборот кулера
TEMP_POLL_INTERVAL = 1          # Интервал опроса температуры процессора (сек) настроен под noctua a4x10 pwm
```

## Docker Compose:
```
services:
  myrpi5:
    image: sergeybutakov/myrpi5:latest
    container_name: myrpi5
    privileged: true
    devices:
      - /dev/gpiochip0:/dev/gpiochip0
    volumes:
      - /sys:/sys:ro
      - /proc:/proc:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
    environment:
      - UPDATE_INTERVAL=2.0 # интервал обновления в секундах
    network_mode: host
    ports:
      - 5000:5000
    restart: unless-stopped
```
